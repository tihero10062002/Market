(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==typeof t?t:String(t)}function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}!function(){let e=function(){function e(e,t,i,r){var n;this.parentId=e,this.nmId=t.nmId,this.chrtId=null===(n=t.selectedSize)||void 0===n?void 0:n.characteristicId,this.analytics=i,this.supplierHelper=r,this.parentInfo=this._getParentInfo(t),this.totalCount=0,this.canRender=!1,this.allSellersLink.depends=["nmId","chrtId"],this.otherSellerMinPrice.depends=["canRender"],this.onMoveToSellersClicked=this.onMoveToSellersClicked.bind(this),this.onCardClicked=this.onCardClicked.bind(this),this.onSizeUpdated=this.onSizeUpdated.bind(this),this.onColorChanged=this.onColorChanged.bind(this),this.onResetOrderButtonsState=this.onResetOrderButtonsState.bind(this)}var t=e.prototype;return t.init=function(){return this._bindEvents(),this},t.destroy=function(){var e;return this._unbindEvents(),null===(e=this.blockWbaObserver)||void 0===e||e.destroy(),this},t.onSizeUpdated=function(e){const{nmId:t,selectedSize:i}=e.detail;this.nmId==t&&$.observable(this).setProperty({chrtId:i})},t.onColorChanged=async function(e){var t;const{isDetailsLoaded:i,sourceId:r,sourceNmId:n,selectedNomenclature:s}=e.detail;if(this.parentId!=r||n!=this.nmId)return;if(this.nmId===s.nmId&&i)return;const o=s.nmId;$.observable(this).setProperty({canRender:!1,nmId:o,chrtId:null===(t=s.selectedSize)||void 0===t?void 0:t.characteristicId}),this.parentInfo=this._getParentInfo(s),this.analytics=this.$analitic.getState();const{nmIds:l}=await this.$services.multipleSellersService.loadOtherSellersNmIds(o);this.showOtherSellersAsync(l)},t.onResetOrderButtonsState=function(e){var t,i;const{sourceId:r,sourceNmId:n}=e.detail;this.parentId==r&&n==this.nmId&&(null===(t=this.sellersList)||void 0===t||null===(i=t.sellers)||void 0===i||i.forEach(e=>$.observable(e).setProperty({addedToBasket:!1})))},t._getParentInfo=function(e){var t,i,r,n;return{rating:null!==(t=null==e?void 0:e.star)&&void 0!==t?t:null===(i=this.parentInfo)||void 0===i?void 0:i.rating,delivery:null==e?void 0:e.deliveryHours,price:(null==e?void 0:null===(r=e.price)||void 0===r?void 0:r.salePrice)||(null==e?void 0:null===(n=e.price)||void 0===n?void 0:n.price)||0,supplierTask:this._getCurrentSupplier.bind(this)}},t.allSellersLink=function(){return`/catalog/${this.nmId}/other-sellers${this.chrtId?"?size="+this.chrtId:""}`},t.otherSellerMinPrice=function(){var e,t,i;return null!==(e=null===(t=this.sellersList)||void 0===t?void 0:null===(i=t.sellers[0])||void 0===i?void 0:i.salePrice)&&void 0!==e?e:0},t.showOtherSellersAsync=async function(e){var t;if(!Array.isArray(e)||e.length<1)return;const[i,r]=await Promise.all([this.$services.multipleSellersService.loadSellersInfoAsync(e),this.$moduleLoader.loadModuleAsync("multipleSellerList"),$.views.loadTemplateAsync("productsupplierinfo")]),n=i.filter(e=>null!=e.salePrice&&null!=e.deliveryModel);0!==n.length&&(n.sort(this._goodsSortFunc),this.sellersList=new r(this.nmId,n.slice(0,3),this.analytics,this.parentInfo),$.observable(this).setProperty({canRender:!0,showAllLink:n.length>3}),null===(t=this.blockWbaObserver)||void 0===t||t.destroy(),this.blockWbaObserver=await this._getBlockViewStatWbaObserver(),this.blockWbaObserver.observe())},t.reportMoreProduct=function(e){this.$moduleLoader.loadModuleAsync("findOtherSellerPopup").then(t=>{t.showFindOtherSellersPopup(e,this.sellersList.sellers.map(e=>e.nmId))})},t.onMoveToSellersClicked=function(...e){var t;this.$moveToAnchor(...e),this.$analitic.sendEvent("Item_Other_Seller_T",{parent_id:null===(t=this.nmId)||void 0===t?void 0:t.toString()})},t.onCardClicked=async function(e,t){var i,r,n;if(e)return void this._sendCarouselWbaEvent("Carousel_All",0,0);const s=t.currentTarget.closest(".j-other-offers-item"),{data:o}=$.view(s),l=parseInt(s.dataset.cardIndex)+1;this.$analitic.proceedAndSave("ICO",l,null,this.nmId);const a=await this._getCurrentSupplier(this.nmId),d={rating:`${o.star},${this.parentInfo.rating}`,delivery_date:`${o.deliveryHours},${this.parentInfo.delivery}`,price:`${o.salePrice||o.price||0},${this.parentInfo.price}`,seller_rating:`${null===(i=o.supplierInfo)||void 0===i?void 0:null===(r=i.extInfo)||void 0===r?void 0:r.rating},${null==a?void 0:null===(n=a.extInfo)||void 0===n?void 0:n.rating}`};this._sendCarouselWbaEvent("Carousel_T",l,o.nmId,d)},t._getCurrentSupplier=async function(e){return this.supplierHelper?await this.supplierHelper.getSuppliersInfo(e):Promise.resolve(null)},t._getBlockViewStatWbaObserver=async function(){var e,t;const i=this,r=(null===(e=document.querySelectorAll(".j-other-offers"))||void 0===e?void 0:e.toArray())||[],n=document.querySelector(".j-move-to-sellers");r.push(n);const s=this.$observerHelper.getVerticalObserver(r);function o(e){var t;const r=null===(t=e.target)||void 0===t?void 0:t.classList.contains("j-move-to-sellers");i._sendBlockViewStatWba(r)}return null===(t=this.blockWbaObserver)||void 0===t||t.destroy(),{observe:function(){r.forEach(e=>{e.addEventListener(s.elementInViewportEventName,o)}),s.observe()},destroy:function(){r.forEach(e=>{e.removeEventListener(s.elementInViewportEventName,o)})}}},t.popupSellersMobileShownStat=async function(){this.mobileBottomBlockShown||(this.mobileBottomBlockShown=!0,this._sendBlockViewStatWba())},t._sendBlockViewStatWba=async function(e){var t;if(e)return void this.$analitic.sendEvent("Item_Other_Seller_S",{parent_id:null===(t=this.nmId)||void 0===t?void 0:t.toString()});const i=this.sellersList.sellers.map(e=>e.nmId),r={rating:[],delivery:[],price:[],parent:this.parentInfoForStat};this.sellersList.sellers.forEach(e=>{r.rating.push(e.star),r.delivery.push(e.deliveryHours),r.price.push(e.salePrice||e.price||0)}),r.rating=r.rating.join(","),r.delivery=r.delivery.join(","),r.price=r.price.join(","),this._sendCarouselWbaEvent("Carousel_S",0,i,r)},t._sendCarouselWbaEvent=function(e,t,i,r={}){this.$analitic.sendCarouselWbaEvent(e,"ICO",t,i,0,r)},t._goodsSortFunc=function(e,t){var i,r;return null==e.salePrice&&null==t.salePrice?0:null==e.salePrice?1:null==t.salePrice?-1:e.salePrice!==t.salePrice?e.salePrice-t.salePrice:(null===(i=e.deliveryModel)||void 0===i?void 0:i.minDate)-(null===(r=t.deliveryModel)||void 0===r?void 0:r.minDate)},t._bindEvents=function(){this.$eventBus.addEventListener("ProductSizeUpdated",this.onSizeUpdated),this.$eventBus.addEventListener("ProductColorChanged",this.onColorChanged),this.$eventBus.addEventListener("ProductChanged",this.onColorChanged),this.$eventBus.addEventListener("SameProductOpened",this.onResetOrderButtonsState)},t._unbindEvents=function(){this.$eventBus.removeEventListener("ProductSizeUpdated",this.onSizeUpdated),this.$eventBus.removeEventListener("ProductColorChanged",this.onColorChanged),this.$eventBus.removeEventListener("ProductChanged",this.onColorChanged),this.$eventBus.removeEventListener("SameProductOpened",this.onResetOrderButtonsState)},_createClass(e,[{key:"template",get:function(){return e.template}},{key:"parentInfoForStat",get:function(){return`${this.parentInfo.rating},${this.parentInfo.delivery},${this.parentInfo.price}`}}]),e}();window.__spaModuleManager__.register("multipleSellerHelper",e)}();

},{}]},{},[1]);
