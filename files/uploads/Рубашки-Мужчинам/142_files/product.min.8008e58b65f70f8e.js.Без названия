(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";function _defineProperties(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,_toPropertyKey(i.key),i)}}function _createClass(e,t,s){return t&&_defineProperties(e.prototype,t),s&&_defineProperties(e,s),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==typeof t?t:String(t)}function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}!function(){let e=function(){function e(e){var t,s,i;e=null!==(t=null===(s=e)||void 0===s?void 0:s.data)&&void 0!==t?t:e,this.data=e,this.id=this.$generateGuid(),this.renderRecent=!1,this._showRecommendationCarousel=!0,this.analiticState=this.$analitic.getState(),this.deliveryHelper={},this.videoReviews=null,this.statCardWba=null,this.cardCommonActionEventsWba=this.cardCommonActionEventsWba.bind(this),this.cardCommonShowEventsWba=this.cardCommonShowEventsWba.bind(this),this.getVideoReviewsUrl="https://video-reviews.wildberries.ru/api/v1/video-by-nm",this.recommendationUrlHelper.depends=["selectedNomenclature","selectedNomenclature.nmId"],this.showMinAddedOptions.depends=["product"],this.multipleSellersHelper=null,this.priceHistoryHelper=null,this.stickyPanel=null,this.initComments=this.initComments.bind(this),this.currentTab="c",this.articlesCount=0,this.videosCount=0,this.questionsCount=null!==(i=this.questionsCount)&&void 0!==i?i:0,this.unrendered=!1,this.onSizeUpdated=this.onSizeUpdated.bind(this),this.onFavoritesUpdate=this.onFavoritesUpdate.bind(this),this.onColorChanged=this.onColorChanged.bind(this),this.onProductChanged=this.onProductChanged.bind(this),this.getAndClickCertificateLink=this.getAndClickCertificateLink.bind(this)}var t=e.prototype;return t.recommendationUrlHelper=function(){return{alsoBuy:wb.urlHelper.alsoBuyCatalog(this.selectedNomenclature.nmId),similarGoods:`/recommendation/catalog?type=similar&forproduct=${this.selectedNomenclature.nmId}&excludeNms=true`,recommendedByNm:wb.urlHelper.recommendedByNmCatalog(this.selectedNomenclature.nmId),promo:wb.urlHelper.promoCatalogByNm(this.selectedNomenclature.nmId)}},t.showMinAddedOptions=function(){var e,t,s,i;if(!((null===(e=this.selectedNomenclature.minGroupedAddedOptions)||void 0===e?void 0:e.length)>0))return!1;return!!this.selectedNomenclature.minGroupedAddedOptions.some(e=>{var t;return(null===(t=e.addedOptions)||void 0===t?void 0:t.length)>0})&&(this.selectedNomenclature.showMinDetails&&((null===(t=this.selectedNomenclature.groupedAddedOptions)||void 0===t?void 0:t.length)!==(null===(s=this.selectedNomenclature.minGroupedAddedOptions)||void 0===s?void 0:s.length)||!(null!==(i=this.selectedNomenclature.minGroupedAddedOptions)&&void 0!==i&&i.every((e,t)=>{var s,i;return(null===(s=this.selectedNomenclature.groupedAddedOptions[t])||void 0===s?void 0:null===(i=s.addedOptions)||void 0===i?void 0:i.length)===e.addedOptions.length}))))},t.onBeforeRender=async function(){var e,t;this.$analitic.updateAnaliticsFromQuery(),this.analiticState=this.$analitic.getState();const s=this.fromSSR?Promise.resolve(null!==(e=null===(t=this.data)||void 0===t?void 0:t.data)&&void 0!==e?e:this.data):this.data.dataTask,[i,o,r,n,l,d,a,c,u,h,m,v,p,y]=await Promise.all([s,this.$analitic.getSplitInfo(),this.$moduleLoader.loadModuleAsync("suppliersInfoHelper"),this.$moduleLoader.loadModuleAsync("productCardSizes"),this.$moduleLoader.loadModuleAsync("productCardPrice"),this.$moduleLoader.loadModuleAsync("productCardColors"),this.$moduleLoader.loadModuleAsync("productCardOrderGood"),this.$moduleLoader.loadModuleAsync("deliveryInfoHelper"),this.$moduleLoader.loadModuleAsync("productCardPoned"),this.$moduleLoader.loadModuleAsync("productCardImageGallery"),this.$moduleLoader.loadModuleAsync("productCardVideo"),this.$moduleLoader.loadModuleAsync("productCardDescribtionError"),this.$moduleLoader.loadModuleAsync("productCardStats"),this.$moduleLoader.loadModuleAsync("miniProductCard"),this.$services.userData.getUserDataAsync()]);this._splitInfoProcessing(o),Object.assign(this,i),this.colorEvent={openedNm:this.selectedNomenclature.nmId,currentNm:this.selectedNomenclature.nmId},this._updateGoogleTagParams(),this._sendWbaEventOnColorCarouselClick(this.selectedNomenclature.nmId);const b=y.MiniProductCardAdapterHelper.convertFromProductCardViewModel(this);this.miniCard=new y(b,this.$services.userData.userData,this.id,!0),this.statsModel=new p(this.id,this.selectedNomenclature).init(),this.sizeModel=new n(this.id,this.selectedNomenclature,this.getDeliveryInfoBySize).init(),this.priceModel=new l(this.id,this.selectedNomenclature,this.statsModel).init(),this.colorsModel=new d(this.id,this.selectedNomenclature,this.product,this.targetInfo,!1).init();const w=new u(this.selectedNomenclature,this.targetInfo,this.sizeModel,this.priceModel,this.$services.userData.userData,this.analiticState).init(),g=new m("#photo .j-wb-video-player",this.id,this.selectedNomenclature,this.selectedNomenclature.adult).init();this.ponedModel=w,this.orderModel=new a(this.id,this.selectedNomenclature,this.targetInfo,this.sizeModel,this.priceModel,w).init(),this.deliveryHelper=new c(this.id,this.selectedNomenclature).init(),this.suppliersHelper=null!=r?new r(this.id,this.selectedNomenclature.nmId,this.product.supplierDeliveryInfo,this.statsModel).init():null,this.imageGalleryModel=new h(this.id,this.selectedNomenclature,w,this.deliveryHelper,g,this.statsModel).init(),this.describtionErrorModel=new v(this.id,this.selectedNomenclature,this.statsModel).init(),this.fromSSR||(this._loadLastData(this.selectedNomenclature),this._loadOrdersQnt(),this._loadSearchTags(),this._loadBrandLogo(this.selectedNomenclature),this._loadBrandUrl(this.selectedNomenclature))},t.onAfterRender=async function(){window.requestAnimationFrame(()=>{document.querySelector(".j-footer").classList.add("footer--padding")}),this._bindEvents(),this.sizeModel.checkSizeList();const e=this.selectedNomenclature.nmId,t=window.location.hash.substring(1);window.requestIdleCallback(()=>{var e,s;(this.miniCard.init(),null===(e=this.suppliersHelper)||void 0===e||e.showSupplierInfo(),this.colorsModel.initColorsCarousel(),this.imageGalleryModel.initCarousel(),this.statsModel.onProductOpen(),this.selectedNomenclature.isDetailsLoaded)?(this.deliveryHelper.updateAll(),this.showPriceChartAsync(),this.showOtherSellersAsync(),this._sendViewProductStatistic(),this._saveAsRecentlyViews(),this._fillBigSaleUrl()):this._loadFullCardInfo(this.selectedNomenclature.nmId,null===(s=this.selectedNomenclature.selectedSize)||void 0===s?void 0:s.characteristicId,t)}),this.$router.replaceState({selectedNomenclature:e},this._getMetaTagWithPrice(this.metaTags[e].title),window.location.href),this._updateMetaTags(e),this.$adult.proceedIfAdultConfirmed(this.selectedNomenclature.adult),""!=t&&this.$moveToAnchor(t)},t.onBeforeUnrender=function(){var e,t,s,i,o,r,n,l,d,a,c,u,h,m,v,p,y,b,w;this.unrendered=!0,document.querySelector(".j-footer").classList.remove("footer--padding"),this._unbindEvents(),null===(e=this.feedbacksModel)||void 0===e||e.destroy(),null===(t=this.questionsModel)||void 0===t||t.destroy(),null===(s=this.postsModel)||void 0===s||s.destroy(),null===(i=this.stickyPanel)||void 0===i||i.destroy(),null===(o=this.statCardWba)||void 0===o||null===(r=o.destroy)||void 0===r||r.call(o),null===(n=this.multipleSellersHelper)||void 0===n||n.destroy(),null===(l=this.deliveryHelper)||void 0===l||l.destroy(),null===(d=this.sizeModel)||void 0===d||d.destroy(),null===(a=this.priceModel)||void 0===a||a.destroy(),null===(c=this.colorsModel)||void 0===c||c.destroy(),null===(u=this.suppliersHelper)||void 0===u||u.destroy(),null===(h=this.miniCard)||void 0===h||h.destroy(),null===(m=this.orderModel)||void 0===m||m.destroy(),null===(v=this.imageGalleryModel)||void 0===v||v.destroy(),null===(p=this.priceHistoryHelper)||void 0===p||p.destroy(),null===(y=this.describtionErrorModel)||void 0===y||y.destroy(),null===(b=this.statsModel)||void 0===b||b.destroy(),null===(w=this.ponedModel)||void 0===w||w.destroy()},t.onHistoryChange=async function(e,t=!1,s,i){var o;const r=window.location.hash.substring(1),n=parseInt(null!==(o=e.selectedNomenclature)&&void 0!==o?o:this.$router.routeParameters.cod1S);this.$services.userData.getUserDataAsync();let l=Number.tryParseInt(this.$router.queryParams.get("size"));if(null==e.selectedNomenclature&&this.$router.replaceState({selectedNomenclature:n},document.title,window.location.origin+$.views.helpers.productCardUrl(n,l,this.$router.queryParams.get("targetUrl"))),n==this.selectedNomenclature.nmId)return this.$adult.proceedIfAdultConfirmed(this.selectedNomenclature.adult),void this.$eventBus.dispatchEvent(new CustomEvent("SameProductOpened",{detail:{sourceId:this.id,sourceNmId:this.selectedNomenclature.nmId,selectedSize:l}}));const d=this.product.nomenclatures.find(e=>e.nmId==n);if(null==d||t)try{const e=await this.$services.productCard.loadProductCardAsync(n,l);return void(null!=i&&i.aborted||(this.$eventBus.dispatchEvent(new CustomEvent("ProductChanged",{detail:{isDetailsLoaded:e.selectedNomenclature.isDetailsLoaded,sourceId:this.id,sourceNmId:this.selectedNomenclature.nmId,ancherTarget:r,rating:this.product,...e}})),window.requestIdleCallback(()=>this._loadFullCardInfo(n,l,r))))}catch(e){wb.popup.renderModalError(e.message)}else{const e=await this.$services.productCard.loadNomenclature(d),t={sourceId:this.id,sourceNmId:this.selectedNomenclature.nmId,selectedNomenclature:e,fromPopState:!0};null!=i&&i.aborted||this.$eventBus.dispatchEvent(new CustomEvent("ProductColorChanged",{detail:t}))}},t.onActiveViewChanged=function(e){var t;null===(t=this.imageGalleryModel)||void 0===t||t.stopVideo()},t.onSamePageNavigation=function(){window.dispatchEvent(new CustomEvent("spaTransition",{detail:{isFinished:!0}})),window.scrollTo(0,0)},t.onSizeUpdated=function(e){var t;const{nmId:s,selectedSize:i}=e.detail;if(this.selectedNomenclature.nmId!=s)return;if(i==(null===(t=this.selectedNomenclature.selectedSize)||void 0===t?void 0:t.characteristicId))return;const o=this.selectedNomenclature.sizes.find(e=>e.characteristicId===i);if($.observable(this.selectedNomenclature).setProperty("selectedSize",o),"SpaProductCardEntrypoint"===this.$router.currentRoute.name){const e=new URL(window.location.href);o&&e.searchParams.set("size",i),this.$router.replaceState(window.history.state,document.title,e.toString())}},t.onFavoritesUpdate=function(e){const{nmId:t,isPoned:s}=e.detail;t==this.selectedNomenclature.nmId&&s&&$.observable(this).setProperty({favedTrigger:Date.now()})},t.onColorChanged=function(e){var t,s,i;const{sourceId:o,sourceNmId:r,selectedNomenclature:n,fromPopState:l}=e.detail;if(o!=this.id||r!=this.selectedNomenclature.nmId)return;const d=n.nmId;this._loadBrandLogo(n,this.selectedNomenclature),this._loadBrandUrl(n,this.selectedNomenclature),this._loadLastData(n,this.selectedNomenclature),$.observable(this).setProperty({selectedNomenclature:n,showRecommendationCarousel:!1,articlesCount:0,videosCount:0}),null===(t=this.showOtherSellersAsync)||void 0===t||t.call(this),this.showPriceChartAsync(),this.checkArticlesCount(),this.checkVideosCount(),this._fillBigSaleUrl(),this._sendWbaEventOnColorCarouselClick(d),this.colorEvent.currentNm=d,this._sendShownPageStateWba(),!l&&this.$router.replaceState({selectedNomenclature:d},this._getMetaTagWithPrice(this.metaTags[d].title),$.views.helpers.productCardUrl(d,null,null===(s=this.targetInfo)||void 0===s?void 0:s.targetUrl)),this._sendViewProductStatistic(),null===(i=this._updateMetaTags)||void 0===i||i.call(this,d)},t.onProductChanged=function(e){const{isDetailsLoaded:t,sourceId:s,sourceNmId:i,ancherTarget:o,...r}=e.detail;if(s!=this.id||this.selectedNomenclature.nmId!=i)return;const n=window._debug&&performance.now();this.analiticState=wb.analitics.getState();const l=r.selectedNomenclature.nmId;if(t){var d;this.selectedNomenclature.nmId,r.selectedNomenclature.nmId;this._loadBrandLogo(r.selectedNomenclature,this.selectedNomenclature),this._loadBrandUrl(r.selectedNomenclature,this.selectedNomenclature),this._loadLastData(r.selectedNomenclature,this.selectedNomenclature),this.$observable.setProperty({product:r.product,metaTags:r.metaTags,selectedNomenclature:r.selectedNomenclature,feedbacksModel:null,questionsModel:null,postsModel:null,currentTab:"c",showRecommendationCarousel:!1,articlesCount:0,videosCount:0}),this._loadOrdersQnt(),$.observable(this).setAllProperty(r),this.showRecommendationCarousel&&$.observable(this).setProperty({showRecommendationCarousel:!1}),this.showPriceChartAsync(),this.showOtherSellersAsync(),this._updateGoogleTagParams(),this._saveAsRecentlyViews(),this._resetTones(),this._fillBigSaleUrl(),this._sendShownPageStateWba(),null===(d=this._updateMetaTags)||void 0===d||d.call(this,l),this._sendViewProductStatistic(),this._loadSearchTags(),window.dispatchEvent(new CustomEvent("inPlaceFullUpdate",{detail:{isPopupMode:!1}}))}else{var a,c,u,h;window.scrollTo(0,0),this.$observable.setProperty({videosCount:0}),r.selectedNomenclature.ordersCount=0,this._loadBrandLogo(r.selectedNomenclature,this.selectedNomenclature),this._loadBrandUrl(r.selectedNomenclature,this.selectedNomenclature),this._loadLastData(r.selectedNomenclature,this.selectedNomenclature),$.observable(this).setAllProperty(r),$.observable(null!==(a=this.selectedNomenclature.groupedAddedOptions)&&void 0!==a?a:[]).refresh(null!==(c=r.selectedNomenclature.groupedAddedOptions)&&void 0!==c?c:[]),$.observable(null!==(u=this.sitePath)&&void 0!==u?u:[]).refresh(null!==(h=r.sitePath)&&void 0!==h?h:[])}this.$adult.proceedIfAdultConfirmed(this.selectedNomenclature.adult),null!=o&&""!==o&&this.$moveToAnchor(o),window._debug&&console.log("[PRODUCT_CARD]: changed",performance.now()-n)},t.copyNmId=function(){var e;if(this.$isDesktop)return;const t=null!==(e=navigator.clipboard)&&void 0!==e&&e.writeText?navigator.clipboard.writeText(this.selectedNomenclature.nmId):this._copyNmIdFallback();Promise.all([this.$moduleLoader.loadModuleAsync("bottomNotificationPanel"),t]).then(([e])=>{e.showNotification(e.notificationsType.copyNmId)})},t._copyNmIdFallback=function(){var e=document.createRange();return e.selectNode(document.getElementById("productNmId")),window.getSelection().removeAllRanges(),window.getSelection().addRange(e),document.execCommand("copy"),window.getSelection().removeAllRanges(),Promise.resolve()},t.showOtherSellersAsync=async function(){if(this.multipleSellersHelper)return;await this.$moduleLoader.loadServiceAsync("multipleSellersService");const{nmIds:e}=await this.$services.multipleSellersService.loadOtherSellersNmIds(this.selectedNomenclature.nmId);if(!this.unrendered){const t=await this.$moduleLoader.loadModuleAsync("multipleSellerHelper");$.observable(this).setProperty({multipleSellersHelper:new t(this.id,this.selectedNomenclature,this.analiticState,this.suppliersHelper).init()}),this.multipleSellersHelper.showOtherSellersAsync(e)}},t.showPriceChartAsync=async function(){var e,t;if(null===(e=wb.global.settings)||void 0===e||null===(t=e.switches)||void 0===t||!t.enablePriceHistoryChart||this.priceHistoryHelper)return;const s=this.selectedNomenclature.nmId,i=await this.$services.productCard.loadPriceHistory(s);if(null!=i&&!this.unrendered){var o,r;const e=await this.$moduleLoader.loadModuleAsync("priceHistoryChart");$.observable(this).setProperty({priceHistoryHelper:new e(this.id,s).init()}),this.priceHistoryHelper.showChartAsync(i,{currentPrice:null===(o=this.priceModel.selectedPrice)||void 0===o?void 0:o.salePrice,logisticsCost:null===(r=this.priceModel.selectedPrice)||void 0===r?void 0:r.logisticsCost})}},t.showSocialSharePopup=function(){this.$moduleLoader.loadModuleAsync("productShareHelper").then(e=>{e.showSocialSharePopup(this.selectedNomenclature.nmId,this.selectedNomenclature.goodsName,this.selectedNomenclature.brandName)})},t.showClaimReportPopup=function(){this.$moduleLoader.loadModuleAsync("claimsReporter").then(e=>{this.claimsReporter||(this.claimsReporter=new e),this.claimsReporter.reportClaim(this.selectedNomenclature.nmId)})},t.checkVideosCount=function(){const e=this.selectedNomenclature.nmId;if(wb.global.settings.switches.enableVideoReviews)return this.$services.productCard.loadProductVideosAsync(this.selectedNomenclature.nmId).then(t=>{var s;if(this.selectedNomenclature.nmId!=e)return;const i=null!==(s=null==t?void 0:t.length)&&void 0!==s?s:0;$.observable(this).setProperty({videosCount:i})})},t.showVideoReviews=function(){if(!wb.global.settings.switches.enableVideoReviews)return;const e=this.selectedNomenclature.nmId;return this.$services.productCard.loadProductVideosAsync(this.selectedNomenclature.nmId).then(t=>{var s;if(!((null!==(s=null==t?void 0:t.length)&&void 0!==s?s:0)<=0))return this.$moduleLoader.loadModuleAsync("videoReviews").then(s=>{var i;this.selectedNomenclature.nmId==e&&(s.data||(s.data={}),s.data.cardCommonActionEventsWba=this.cardCommonActionEventsWba,this.videoReviews=new s(document.getElementById("videoReviewsContainer"),t,s.template,s.data),this.videoReviews.renderAsync(),null===(i=this.statCardWba)||void 0===i||i.sendEvent("Item_Videoreviews_S"))})}).catch(e=>!e.isCustomError&&console.error(e.message))},t.disposeVideoReviews=function(){var e;null===(e=this.videoReviews)||void 0===e||e.dispose()},t.reportToSupplierService=function(){this.$moduleLoader.loadModuleAsync("findOtherSellerPopup").then(e=>{var t,s,i;e.showFindOtherSellersPopup(this.selectedNomenclature.nmId,null!==(t=null===(s=this.multipleSellersHelper)||void 0===s?void 0:null===(i=s.sellersList)||void 0===i?void 0:i.sellers.map(e=>e.nmId))&&void 0!==t?t:[])})},t.digitalLinkClicked=function(e){var t;null===(t=e.currentTarget)||void 0===t||t.dispatchEvent(new Event("mouseout"))},t.getAndClickCertificateLink=function(){this.selectedNomenclature.verifiedCertificate&&this.$httpClient.fetchBasicJSON(wb.helpers.url.urlCertificateStatic(this.selectedNomenclature.nmId)).then(e=>{e.NmId==this.selectedNomenclature.nmId&&e.url&&setTimeout(()=>window.open(e.url,"_blank"))})},t._splitInfoProcessing=function(e){const{splitId:t,title:s}=e;"115"===t&&"test_1"===s&&$.observable(this).setProperty({splitTest:!0}),"133"===t&&"test_1"===s&&(this.feedbackDefaultSort="rankDesc")},t._loadFullCardInfo=async function(e,t,s){if(!this.selectedNomenclature.isDetailsLoaded)try{const i=await this.$services.productCard.loadDynamicProductAsync(e,t,await this.$services.productCard.loadStaticProductAsync(e));this.$eventBus.dispatchEvent(new CustomEvent("ProductChanged",{detail:{isDetailsLoaded:i.selectedNomenclature.isDetailsLoaded,sourceId:this.id,sourceNmId:this.selectedNomenclature.nmId,anchorTarget:s,rating:this.product,...i}}))}catch(e){console.log(e)}},t._loadLastData=async function(e,t){const s=e.nmId,i=null==t?void 0:t.subjectId,o=null==t?void 0:t.kindId,r=null==t?void 0:t.brandId,n=this.$router.queryParams.get("targetUrl");if(null!=t&&t.brandAndSubjectUrl&&i===e.subjectId&&r===e.brandId&&o===e.kindId)e.brandAndSubjectUrl=t.brandAndSubjectUrl,e.categoryUrl=t.categoryUrl;else{var l,d,a;const t=new URLSearchParams({subject:e.subjectId,kind:e.kindId,brand:e.brandId});n&&t.set("targetUrl",n);const i=await this.$httpClient.fetchJSON(`/webapi/product/${s}/data?${t.toString()}`,{},{noProcessResponse:!0}).catch(e=>null),o=null==i?void 0:null===(l=i.value)||void 0===l?void 0:l.data;if(!o)return null;o.categoryUrl=null===(d=o.sitePath)||void 0===d?void 0:null===(a=d[o.sitePath.length-2])||void 0===a?void 0:a.pageUrl,$.observable(this).setProperty({sitePath:o.sitePath,targetInfo:o.targetInfo}),$.observable(this.selectedNomenclature).setProperty({brandAndSubjectUrl:o.brandAndSubjectUrl,categoryUrl:o.categoryUrl}),this.$eventBus.dispatchEvent(new CustomEvent("ProductLastDataRecived",{detail:{sourceId:this.id,sourceNmId:s,lastPart:o}}))}},t._loadOrdersQnt=async function(){const e=this.selectedNomenclature.nmId;if(!this.product.nomenclatures)return;const t=this.product.nomenclatures.map(e=>e.nmId),s=await this.$httpClient.fetchBasicJSON(`https://product-order-qnt.wildberries.ru/by-nm/?nm=${t.join(",")}`,{credentials:"omit"},{nullOnError:!0});s&&this.product.nomenclatures.forEach(t=>{const i=s.find(e=>e.nmId===t.nmId);i&&(t.ordersCount=i.qnt),i&&i.nmId===e&&$.observable(this.selectedNomenclature).setProperty({ordersCount:i.qnt})})},t._loadSearchTags=async function(){var e,t,s;const i=this.selectedNomenclature.nmId,o=await this.$analitic.getSplitterHeaders(),r=await this.$httpClient.fetchBasicJSON(`https://search-tags.wildberries.ru/tags?nm_id=${i}`,{credentials:"omit",headers:o},{nullOnError:!0});if(!r||!r.length)return $.observable(this).setProperty({searchTags:null}),null;const n={tagsViewModels:r.map(e=>({href:`/catalog/0/search.aspx?search=${e.toSafeString()}&targeturl=ST&xsearch=true`,text:e,type:1})),drawType:1,tagsQuery:"C этим товаром искали"};this.searchTags?$.observable(null!==(e=null==this?void 0:null===(t=this.searchTags)||void 0===t?void 0:t.tagsViewModels)&&void 0!==e?e:[]).refresh(null!==(s=null==n?void 0:n.tagsViewModels)&&void 0!==s?s:[]):$.observable(this).setProperty({searchTags:n})},t._loadBrandLogo=async function(e,t){const s=null==t?void 0:t.brandId,i=e.brandId;if(null!=t&&t.brandLogo&&s===i)e.brandLogo=t.brandLogo;else{const e=i?$.views.helpers.forBrandLogoFromId(i):null;if(this.selectedNomenclature.brandLogo!==e){const t=new Image;t.addEventListener("load",()=>{$.observable(this.selectedNomenclature).setProperty({brandLogo:e})},!1),t.addEventListener("error",()=>{$.observable(this.selectedNomenclature).setProperty({brandLogo:null})},!1),t.src=e}}},t._loadBrandUrl=async function(e,t){const s=null==t?void 0:t.brandId,i=e.brandId;if(null!=t&&t.brandUrl&&s===i)e.brandUrl=t.brandUrl,e.brandUrlAll=t.brandUrlAll;else{const t=await $.views.helpers.brandUrlById(e.brandId);$.observable(this.selectedNomenclature).setProperty({brandUrl:t,brandUrlAll:t?t+"/all":null})}},t._resetTones=function(){const e=document.querySelector(".j-colors-list");null!=e&&(e.classList.remove("shown"),e.style.removeProperty("max-height"))},t._sendViewProductStatistic=async function(){var e;const t=this.selectedNomenclature.nmId,s=[this.$stat.wrapParam("GCL",t),this.$stat.wrapParam("TURL",null===(e=this.targetInfo)||void 0===e?void 0:e.targetUrl),this.$stat.wrapParam("REF",this.isPopup?window.location.pathname+window.location.search:this.$router.referrer.replace(/^[^:]+:\/\/[^/]+/,"")),this.$stat.wrapParam("BRID",0),this.$stat.wrapParam("SID",this.selectedNomenclature.subjectId)];if(this.$stat.sendEvent("GCO",s),window.wba){var i,o,r,n,l,d;const[e,s]=await Promise.all([this._getSellerForStatAsync(),this._getStoreIdForStatAsync()]),a={id:t,chrt:null===(i=this.miniCard)||void 0===i?void 0:i.characteristicId,name:this.selectedNomenclature.goodsName,brand:this.selectedNomenclature.brandName,price:(null===(o=this.priceModel.selectedPrice)||void 0===o?void 0:o.salePrice)||0,inListIndex:this.analiticState.iid||1,listName:`${this.analiticState.l}||${this.analiticState.s}|${null!==(r=this.analiticState.t)&&void 0!==r?r:""}|${null!==(n=this.analiticState.t1)&&void 0!==n?n:""}|${null!==(l=this.analiticState.t2)&&void 0!==l?l:""}|${null!==(d=this.analiticState.t3)&&void 0!==d?d:""}`,variant:this.selectedNomenclature.colorName,quantity:1,affiliation:e,storeId:s,subjectId:this.selectedNomenclature.subjectId,subjectParentId:this.selectedNomenclature.subjectParentId};this.$analitic.sendWbaEcomStat("view_item",[a])}},t.cardCommonActionEventsWba=function(e){var t;return null===(t=this.statsModel)||void 0===t?void 0:t.cardCommonActionEventsWba(e)},t.cardCommonShowEventsWba=function(e){var t;return null===(t=this.statsModel)||void 0===t?void 0:t.cardCommonShowEventsWba(e)},t._getStoreIdForStatAsync=async function(){var e;const t=null!==(e=this.deliveryHelper)&&void 0!==e&&e.deliveryModelTask?this.deliveryHelper.deliveryModelTask.promise:Promise.resolve(null),s=await t;return null==s?void 0:s.storeId},t._getSellerForStatAsync=async function(){const e=this.selectedNomenclature.nmId;if(null==this.suppliersHelper){await this.$moduleLoader.loadServiceAsync("suppliersService");const t=this.$services.suppliersService.loadBasicSupplierInfoAsync(e);return Promise.resolve(null==t?void 0:t.supplierId)}{var t;const s=await this.suppliersHelper.getSuppliersInfo(e);return Promise.resolve(null==s?void 0:null===(t=s.suppliersInfo)||void 0===t?void 0:t.supplierId)}},t._updateGoogleTagParams=function(){this.$setGoogleTagsModel(this.googleTagParams)},t._saveAsRecentlyViews=async function(){if(this.selectedNomenclature.adult)return;$.observable(this).setProperty({renderRecent:!1});const e=this.selectedNomenclature.nmId;this.$recentViews.addProduct(e);const t=new URLSearchParams({count:11,cod1S:e});try{await this.$httpClient.fetchJSON("/webapi/product/saverecent",{method:"POST",body:t})}catch(e){e.isCustomError||console.error(e.message)}finally{$.observable(this).setProperty({renderRecent:!0})}},t._sendWbaEventOnColorCarouselClick=function(e){const t=this.product.nomenclatures.indexOf(this.colorEvent.currentNm),s=this.product.nomenclatures.indexOf(e);if(window.wba){const e={quantity:t===s?0:s+1,item_id:this.colorEvent.openedNm};this.$analitic.sendEvent(s>t?"Item_Variant_Scroll_Right_T":"Item_Variant_Scroll_Left_T",e)}},t._sendShownPageStateWba=function(){this.$analitic.sendEvent("Screen_V",{name:"Item"})},t._fillBigSaleUrl=async function(){this.selectedNomenclature&&!this.selectedNomenclature.bigSaleUrl&&this.selectedNomenclature.panelPromoId&&this.$promotionsHelper.getById(this.selectedNomenclature.panelPromoId).then(e=>{e&&$.observable(this.selectedNomenclature).setProperty({bigSaleUrl:`/promotions/${e.url}`})})},t._getReferrerUrl=function(e){try{const t=new URL(this.$productCardHelper.currentProductCardReferrer);return t.hostname==window.location.hostname?t.toString():e}catch(t){return e}},t._bindEvents=function(){this.$eventBus.addEventListener("ProductSizeUpdated",this.onSizeUpdated),this.$eventBus.addEventListener("FavoriteGoodsUpdated",this.onFavoritesUpdate),this.$eventBus.addEventListener("ProductColorChanged",this.onColorChanged),this.$eventBus.addEventListener("ProductChanged",this.onProductChanged)},t._unbindEvents=function(){this.$eventBus.removeEventListener("ProductSizeUpdated",this.onSizeUpdated),this.$eventBus.removeEventListener("FavoriteGoodsUpdated",this.onFavoritesUpdate),this.$eventBus.removeEventListener("ProductColorChanged",this.onColorChanged),this.$eventBus.removeEventListener("ProductChanged",this.onProductChanged)},t._updateMetaTags=function(e){const t=[];t.push({tagName:"title",htmlContent:this._getMetaTagWithPrice(this.metaTags[e].title)}),t.push({tagName:"meta",attributesDictionary:{name:"description",content:this._getMetaTagWithPrice(this.metaTags[e].description)}}),this.$seoHelper.render(t)},t._getMetaTagWithPrice=function(e){var t;const s=null!==(t=this.priceModel.selectedPrice)&&void 0!==t&&t.price?`${this.$localziation.forAmount} ${$.views.converters.priceWithCurrencyV2(this.priceModel.selectedPrice.salePrice)}`:"";return e.replace(/%FORPRICE%/,s)},t.switchTab=function(e,t){var s,i,o,r;switch(t.preventDefault(),this.$observable.setProperty({currentTab:e}),this.currentTab){case"q":this.initQuestions(),null===(s=this.statCardWba)||void 0===s||s.sendClickEvent("Item_Question");break;case"p":this.showPostsPreviews(),null===(i=this.statCardWba)||void 0===i||i.sendClickEvent("Item_Article");break;case"c":this.initComments(),null===(o=this.statCardWba)||void 0===o||o.sendClickEvent("Item_Feedback");break;case"v":this.showVideoReviews(),null===(r=this.statCardWba)||void 0===r||r.sendClickEvent("Item_Video");break;default:console.warn("tab is unknown")}return!1},t.checkArticlesCount=async function(){return null},t.getQuestionsCount=async function(){const e=this.selectedNomenclature.nmId;try{await this.$moduleLoader.loadServiceAsync("productQuestionsService");const t=await this.$services.productQuestionsService.loadQuestionCountAsync(this.product.imtId);if(e!==this.selectedNomenclature.nmId)return;$.observable(this.product).setProperty({questionsCount:t})}catch(e){console.error(e)}},t.initComments=function(){if("c"!=this.currentTab||null!=this.feedbacksModel)return;const e=this.selectedNomenclature.nmId;this.getQuestionsCount(),this.checkArticlesCount(),this.checkVideosCount(),this.$moduleLoader.loadServiceAsync("productFeedbacksService").then(()=>Promise.all([this.$services.productFeedbacksService.loadSummaryAndVotes(this.product.imtId,e,30,this.feedbackDefaultSort),this.$moduleLoader.loadModuleAsync("productFeedbacksModel"),this.$moduleLoader.loadModuleAsync("summaryModel"),this.$moduleLoader.loadModuleAsync("feedbacksPhotoGallery")])).then(([{summary:t,votes:s},i,o,r])=>{var n;if(e!==this.selectedNomenclature.nmId)return;const l=new o(t,this.selectedNomenclature.showSize),d={imtId:this.product.imtId,nmId:this.selectedNomenclature.nmId,chrtId:null===(n=this.selectedNomenclature.selectedSize)||void 0===n?void 0:n.characteristicId,goodName:this.selectedNomenclature.goodsName,brandName:this.selectedNomenclature.brandName,adult:this.selectedNomenclature.adult},a={feedbacks:t.feedbacks,summaryModel:l},c={votes:s,summary:t},u=new i(this.id,d,a,new r(null==t?void 0:t.photo,this.selectedNomenclature.adult),c);u.loaded=!0,$.observable(this).setProperty({feedbacksModel:u}),this.$helper.nextTick().then(e=>{this.feedbacksModel.init()})})},t.initQuestions=function(){const e=this.selectedNomenclature.nmId;this.$moduleLoader.loadServiceAsync("productQuestionsService").then(()=>Promise.all([this.$services.productQuestionsService.loadQuestionsAsync(this.product.imtId,30),this.$moduleLoader.loadModuleAsync("productQuestionsModel"),this.$moduleLoader.loadModuleAsync("questionsEditor"),this.$services.userData.getUserDataAsync()])).then(([t,s,i])=>{var o;if(this.selectedNomenclature.nmId!==e)return;const r=new i(this.product.imtId,this.selectedNomenclature.goodsName,this.$services.userData.userData.isAuthenticated,this.selectedNomenclature.nmId),n={imtId:this.product.imtId,nmId:this.selectedNomenclature.nmId,chrtId:null===(o=this.selectedNomenclature.selectedSize)||void 0===o?void 0:o.characteristicId},l=new s(this.id,n,t,r);return $.observable(this).setProperty({questionsModel:l}),this.$helper.nextTick().then(()=>{this.questionsModel.init()})})},t.showPostsPreviews=function(){const e=this.selectedNomenclature.nmId;return Promise.all([this.$moduleLoader.loadServiceAsync("productArticlesService").then(()=>this.$services.productArticlesService.loadArticlesAsync(this.selectedNomenclature.nmId)),this.$moduleLoader.loadModuleAsync("postsModel")]).then(([t,s])=>{if(this.selectedNomenclature.nmId!=e)return;const i=new s(this.id,this.nmId,t.posts);$.observable(this).setProperty({postsModel:i}),this.$helper.nextTick().then(()=>{this.postsModel.init()})})},t.showRulesPopup=function(e){return $.views.loadTemplateAsync("CommentGoodRules").then(e=>{wb.popup.showCustomPopup({msg:e(),lockScroll:!0,popupClassesList:["i-popup-comment-rules","shown"],contentClasses:["popup__content"],useCenteredFunction:!0,useHtml:!0})}),!1},t.showCommentPopup=function(){var e;return null===(e=this.feedbacksModel)||void 0===e?void 0:e.showCommentPopup()},_createClass(e,[{key:"getDeliveryInfoBySize",get:function(){return{getDeliveryInfo:e=>{var t,s;return null===(t=(s=this.deliveryHelper).getByChrtId)||void 0===t?void 0:t.call(s,e)}}}},{key:"showRecommendationCarousel",get:function(){return this._showRecommendationCarousel},set:function(e){this._showRecommendationCarousel=e,e||setTimeout(()=>$.observable(this).setProperty({showRecommendationCarousel:!0}),50)}}]),e}();wb.spa.registerViewModel(e)}();

},{}]},{},[1]);
